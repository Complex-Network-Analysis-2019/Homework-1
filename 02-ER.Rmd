# 随机网络

我们选取了N为20、40、60的三种情况，并对三种情况分别生成平均度为0.5，1和5的ER随机网络。表\@ref(tab:config-ER)给出了ER随机网络配置情况。

```{r define-ER-generation}
generate_random_network <- function(n, p) {
  edge_list <- expand_grid(n1 = 1:n, n2 = 1:n) %>%
    filter(n1 < n2) %>%
    mutate(
      connected = map_lgl(
        n1,
        ~ if_else(
          runif(1) < p,
          TRUE, FALSE
        )
      )
    ) %>%
    filter(connected) %>%
    select(n1, n2) %>%
    as.matrix()
  graph_from_edgelist(edge_list, directed = FALSE)
}
```

```{r config-ER}
config_er <- expand_grid(
  tibble(
    graph_type = c("平均度：0.5", "平均度：1", "平均度：5"),
    mean_k = c(0.5, 1, 5)
  ),
  n = c(20, 40, 60)
) %>%
  mutate(p = mean_k / n)
config_er %>%
  select(n, p, mean_k) %>%
  knitr::kable(
    digits = 4,
    col.names = c("N", "p", "平均度"),
    caption = "ER随机网络类型配置"
  )
```

```{r generate-ER, cache=TRUE}
set.seed(20191112)
random_graphs <- tibble(
  graph_type = c("平均度：0.5", "平均度：1", "平均度：5"),
  # generate 100 random networks for each type
  mean_k = c(0.5, 1, 5),
  n = 20, p = mean_k / n
) %>%
  slice(rep(row_number(), 100)) %>%
  mutate(
    graph = map2(
      n, p, generate_random_network
    )
  )
```

```{r select-er-graph}
graphs_to_plot <- random_graphs %>%
  group_by(graph_type) %>%
  nest() %>%
  mutate(
    graph_sel = map(
      data,
      ~ sample_n(.x, 1)
    )
  ) %>%
  unnest(graph_sel) %>%
  ungroup() %>%
  select(-data)
```

```{r visual-1}
plot(
  graphs_to_plot$graph[[1]],
  layout = layout_in_circle,
  vertex.color = "black",
  vertex.size = 4,
  vertex.label = NA,
  edge.curved = 0
)
```

```{r visual-2}
plot(
  graphs_to_plot$graph[[2]],
  layout = layout_in_circle,
  vertex.color = "black",
  vertex.size = 4,
  vertex.label = NA,
  edge.curved = 0
)
```

```{r visual-3}
plot(
  graphs_to_plot$graph[[3]],
  layout = layout_in_circle,
  vertex.color = "black",
  vertex.size = 4,
  vertex.label = NA,
  edge.curved = 0
)
```

```{r degree-distribution-ER}
random_graphs %>%
  mutate(
    degree = map(graph, degree)
  ) %>%
  unnest(degree) %>%
  group_by(graph_type, n, p, degree) %>%
  count(name = "count") %>%
  mutate(n_degree = count / n) %>%
  ggplot(aes(degree, n_degree)) +
  geom_bar(stat = "identity", fill = "lightblue") +
  labs(x = "度", y = "")
  facet_wrap(~ graph_type)
```

```{r clustering-coefficient}
random_graphs %>%
  mutate(
    clustering_coeffiecient = map_dbl(
      graph,
      ~ transitivity(.x, "global")
    )
  ) %>%
  group_by(graph_type, n, p) %>%
  summarise(clustering_coeffiecient = mean(clustering_coeffiecient)) %>%
  knitr::kable(digits = 2)
```
